/*!
 * Particleground
 *
 * @author Jonathan Nicol - @mrjnicol
 * @version 1.1.0
 * @description Creates a canvas based particle system background
 *
 * Inspired by http://requestlab.fr/ and http://disruptivebydesign.com/
 */
!function(a,b){"use strict";function c(a){a=a||{};for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var d in c)c.hasOwnProperty(d)&&("object"==typeof c[d]?deepExtend(a[d],c[d]):a[d]=c[d])}return a}function d(d,g){function h(){if(y){r=b.createElement("canvas"),r.className="pg-canvas",r.style.display="block",d.insertBefore(r,d.firstChild),s=r.getContext("2d"),i();for(var c=Math.round(r.width*r.height/g.density),e=0;c>e;e++){var f=new n;f.setStackPos(e),z.push(f)}a.addEventListener("resize",function(){k()},!1),b.addEventListener("mousemove",function(a){A=a.pageX,B=a.pageY},!1),D&&!C&&a.addEventListener("deviceorientation",function(){F=Math.min(Math.max(-event.beta,-30),30),E=Math.min(Math.max(-event.gamma,-30),30)},!0),j(),q("onInit")}}function i(){r.width=d.offsetWidth,r.height=d.offsetHeight,s.fillStyle=g.dotColor,s.strokeStyle=g.lineColor,s.lineWidth=g.lineWidth}function j(){if(y){u=a.innerWidth,v=a.innerHeight,s.clearRect(0,0,r.width,r.height);for(var b=0;b<z.length;b++)z[b].updatePosition();for(var b=0;b<z.length;b++)z[b].draw();G||(t=requestAnimationFrame(j))}}function k(){i();for(var a=d.offsetWidth,b=d.offsetHeight,c=z.length-1;c>=0;c--)(z[c].position.x>a||z[c].position.y>b)&&z.splice(c,1);var e=Math.round(r.width*r.height/g.density);if(e>z.length)for(;e>z.length;){var f=new n;z.push(f)}else e<z.length&&z.splice(e);for(c=z.length-1;c>=0;c--)z[c].setStackPos(c)}function l(){G=!0}function m(){G=!1,j()}function n(){switch(this.stackPos,this.active=!0,this.layer=Math.ceil(3*Math.random()),this.parallaxOffsetX=0,this.parallaxOffsetY=0,this.position={x:Math.ceil(Math.random()*r.width),y:Math.ceil(Math.random()*r.height)},this.speed={},g.directionX){case"left":this.speed.x=+(-g.maxSpeedX+Math.random()*g.maxSpeedX-g.minSpeedX).toFixed(2);break;case"right":this.speed.x=+(Math.random()*g.maxSpeedX+g.minSpeedX).toFixed(2);break;default:this.speed.x=+(-g.maxSpeedX/2+Math.random()*g.maxSpeedX).toFixed(2),this.speed.x+=this.speed.x>0?g.minSpeedX:-g.minSpeedX}switch(g.directionY){case"up":this.speed.y=+(-g.maxSpeedY+Math.random()*g.maxSpeedY-g.minSpeedY).toFixed(2);break;case"down":this.speed.y=+(Math.random()*g.maxSpeedY+g.minSpeedY).toFixed(2);break;default:this.speed.y=+(-g.maxSpeedY/2+Math.random()*g.maxSpeedY).toFixed(2),this.speed.x+=this.speed.y>0?g.minSpeedY:-g.minSpeedY}}function o(a,b){return b?void(g[a]=b):g[a]}function p(){console.log("destroy"),r.parentNode.removeChild(r),q("onDestroy"),f&&f(d).removeData("plugin_"+e)}function q(a){void 0!==g[a]&&g[a].call(d)}var r,s,t,u,v,w,x,y=!!b.createElement("canvas").getContext,z=[],A=0,B=0,C=!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|mobi|tablet|opera mini|nexus 7)/i),D=!!a.DeviceOrientationEvent,E=0,F=0,G=!1;return g=c({},a[e].defaults,g),n.prototype.draw=function(){s.beginPath(),s.arc(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY,g.particleRadius/2,0,2*Math.PI,!0),s.closePath(),s.fill(),s.beginPath();for(var a=z.length-1;a>=0;a--){var b=z[a];if(b!==this){var c=Math.sqrt(Math.pow(b.position.x-this.position.x,2)+Math.pow(b.position.y-this.position.y,2)).toFixed(2);c<g.proximity&&(s.moveTo(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY),g.curvedLines?c<g.proximity/2&&(s.quadraticCurveTo(this.position.x+this.parallaxOffsetX+((this.position.x+(b.position.x-this.position.x)/2)-this.position.x)/2,this.position.y+this.parallaxOffsetY+((this.position.y+(b.position.y-this.position.y)/2)-this.position.y)/2,b.position.x+this.parallaxOffsetX,b.position.y+this.parallaxOffsetY)):s.lineTo(b.position.x+this.parallaxOffsetX,b.position.y+this.parallaxOffsetY))}}s.stroke(),s.closePath()},n.prototype.updatePosition=function(){if(g.parallax){if(D&&!C){var a=(u-g.resolutionX)/2,b=(v-g.resolutionY)/2;if(w=Math.min(Math.max(-F,-a),a),x=Math.min(Math.max(-E,-b),b),"landscape"===window.orientation?this.parallaxOffsetX=w/g.resolutionX*g.parallaxMultiplierX*(this.layer/2):this.parallaxOffsetX=w/g.resolutionX*g.parallaxMultiplierX,this.parallaxOffsetY=x/g.resolutionY*g.parallaxMultiplierY*(this.layer/2),"undefined"!=typeof g.parallaxOriginX){var c=g.parallaxOriginX,d=g.parallaxOriginY;"object"==typeof c&&c.hasOwnProperty("portrait")&&c.hasOwnProperty("landscape")?(c=C?c.landscape:c.portrait,d=C?d.landscape:d.portrait):(c=g.parallaxOriginX,d=g.parallaxOriginY),"object"==typeof c&&(c=c.x,d=c.y),"string"==typeof c&&(c=parseInt(c,10)),"string"==typeof d&&(d=parseInt(d,10)),"number"==typeof c&&(this.parallaxOffsetX-=(c/g.resolutionX*g.parallaxMultiplierX-this.parallaxOffsetX)*(this.layer/2)),"number"==typeof d&&(this.parallaxOffsetY-=(d/g.resolutionY*g.parallaxMultiplierY-this.parallaxOffsetY)*(this.layer/2))}}switch(g.directionX){case"left":this.position.x+this.speed.x+this.parallaxOffsetX-this.radius>0&&(this.position.x+=this.speed.x);break;case"right":this.position.x+this.speed.x+this.parallaxOffsetX+this.radius<r.width&&(this.position.x+=this.speed.x);break;default:this.position.x+this.speed.x+this.parallaxOffsetX-this.radius>0&&this.position.x+this.speed.x+this.parallaxOffsetX+this.radius<r.width&&(this.position.x+=this.speed.x)}switch(g.directionY){case"up":this.position.y+this.speed.y+this.parallaxOffsetY-this.radius>0&&(this.position.y+=this.speed.y);break;case"down":this.position.y+this.speed.y+this.parallaxOffsetY+this.radius<r.height&&(this.position.y+=this.speed.y);break;default:this.position.y+this.speed.y+this.parallaxOffsetY-this.radius>0&&this.position.y+this.speed.y+this.parallaxOffsetY+this.radius<r.height&&(this.position.y+=this.speed.y)}}},n.prototype.setStackPos=function(a){this.stackPos=a},d.addEventListener?d.addEventListener("DOMContentLoaded",function(){h()},!1):d.attachEvent("onreadystatechange",function(){"complete"===d.readyState&&h()}),this.start=function(){j()},this.pause=function(){l()},this.resume=function(){m()},this.stop=function(){p()},this.option=function(a,b){return"object"==typeof a?void(c=g):void 0!==b?o(a,b):g},this.destroy=function(){p()},this.option(g)},"function"==typeof define&&define.amd?define(function(){return a[e]=d}):"object"==typeof exports?module.exports=d:a[e]=d}(window,document,"Particleground");
